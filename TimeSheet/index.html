<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
    <link href="styles/main.css" rel="stylesheet" />

    <script src="cordova.js"></script>
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.mobile.min.js"></script>   
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>

    <script src="scripts/login.js"></script>
    <script src="scripts/location.js"></script>
    <script src="scripts/weather.js"></script>
    <script src="scripts/app.js"></script>
    <style>
        html .km-wp-light .km-content,
        html .km-wp-light .km-button,
        html .km-wp-light .km-navbar,
        html .km-wp-light .km-detail,
        html .km-wp-light *:not(.k-label) > input:not(.k-input),
        html .km-wp-light .k-dropdown,
        html .km-wp-light *:not(.k-label) > textarea,
        html .km-wp-light *:not(.k-label) > select {
            background: #fff;
        }
    </style>
</head>
<body>
    <!--Home-->
    <div id="tabstrip-home"
        data-role="view"
        data-title="Home">

        <div class="view-content">
            <h1>Tisski Time and Expense Management</h1>
            <a id="skin-change" data-role="button" data-click="app.changeSkin">Flat</a>
            <p>
                The Time and Expenses Management component allows users to complete weekly timesheets detailing work carried out and business expenses incurred. Timesheets will be populated automatically with entries for project activities scheduled for the user, which may be edited or additional entries added. Timesheet and Expense entries are added to a Timesheet, edited and deleted before the user submits the timesheet.
            </p>
            <!--<div class="img"></div>-->
        </div>
    </div>

    <!--Login-->
    <div id="tabstrip-login"
        data-role="view"
        data-title="Login"
        data-model="app.loginService.viewModel">

        <div class="view-content">
            <div class="logo"></div>
            <h3 data-bind="invisible: isLoggedIn">Enter your credentials:</h3>
            <h1 class="welcome" data-bind="visible: isLoggedIn">Welcome, <span data-bind="text: username"></span>!
            </h1>
            <div class="buttonArea">
                <input type="submit" id="logout" data-role="button" data-bind="click: onLogout, visible: isLoggedIn" class="login-button" value="Logout" />
            </div>

            <form data-bind="events: { keyup: checkEnter }">
                <ul data-role="listview" data-style="inset" data-bind="invisible: isLoggedIn">
                    <li>
                        <label>
                            Username
                                <input type="text" data-bind="value: username" />
                        </label>
                    </li>
                    <li>
                        <label>
                            Password
                                <input type="password" data-bind="value: password" />
                        </label>
                    </li>
                </ul>

                <div class="buttonArea">
                    <input type="submit" id="login" data-role="button" data-bind="click: onLogin, invisible: isLoggedIn" class="login-button" value="Login" />
                </div>
            </form>
        </div>

    </div>

 
   <div data-role="view"  data-title="Time & Expense - Weeks" id="tabstrip-TimeSheetWeekly" >
      <div>     
          <ul data-role="listview" data-source="myDataSource" data-template="my-template" data-header-template="header-template" id= "custom-listview" data-bind="click: navigate"></ul>
       </div>
       </div>
    <div data-role="view"  data-title="Time & Expense - Weekly View" id="tabstrip-TimeSheetWeeklyView" data-show="getWeeklyPageParameters">
         <!--<a data-role="button" href="#tabstrip-TimeSheetLog?TimeSheetId=2">Edit with <strong>TimeSheet</strong> with TimeSheetId parameter</a>-->
      <ul data-role="listview" data-source="weeklyviewDS" data-template="weeklydetail-template" data-header-template="weeklyheader-template" id= "weeklylistview"  data-bind="click: process" ></ul> 
        </div>

<style>
    .km-ios #listview-home .km-content {
        background: url(../../content/shared/images/patterns/pattern2.png);
        box-shadow: inset 0 0 30px #95764D;
        -webkit-box-shadow: inset 0 0 30px #95764D;
    }
    .km-ios #listview-home .km-listview .km-list {
        border-radius: 10px;
        -webkit-border-radius: 10px;
        box-shadow: 0 1px 5px #95764D;
        -webkit-box-shadow: 0 1px 5px #95764D;
    }
    .km-ios #listview-home .km-listview .km-list > li {
        border: none;
    }
    .km-ios #listview-home .km-listview .km-list > li:last-child {
        -webkit-box-shadow: none;
        box-shadow: none;
    }
    .km-ios #listview-home .km-navbar {
        background: url(../../content/shared/images/patterns/pattern9.png);
    }
    .km-tablet .km-ios #listview-home .km-view-title {
        color: #fff;
        text-shadow: 0 -1px rgba(0,0,0,.5);
    }
    .km-ios #listview-home .km-navbar .km-button
    {
        background-color: #974d2e;
    }
    
    #custom-listview .item-title {
       
    font-size: 1em;
    line-height: 0em;
   
   
    }
   #custom-listview .item-info {
    float: left;
    font-size: 0.8em;
    line-height: 0em;
    margin: 0.5em 0.5em 0 .95em;
    width: 45%;
}


</style>
    
<script type="text/x-kendo-template" id="my-template" >
<p class="item-info" >#= kendo.toString(kendo.parseDate(WeekStartDate), 'd')#</p> 
  <a data-role="button" class="details-link"  >>></a>
</script>
<script type="text/x-kendo-template" id="header-template">
   <H3 class="item-title" >  #: value # </H3>    
</script>


    <script type="text/x-kendo-template" id="weeklydetail-template">
      #if(Project =="")
         {#<a data-role="button" class="details-link" >Add</a>
          #}
       else
       {# <H5 class="item-info">  #: Project # -  #: StHours # Hours </H5>
          <a data-role="button" class="details-link" id="Editbtn" data-id ="1" >Edit</a>
          <a data-role="button"  class="details-link" id="detelebtn" data-id ="2" >Delete</a>#} # 
</script>

<script type="text/x-kendo-template" id="weeklyheader-template">
    <p class="item-info"> #= kendo.toString(kendo.parseDate(value), 'd')# </p>
</script>
    <script>
        
         var SummaryModel = kendo.data.Model.define({
                   id: "TimeSheetId",
                    fields: {
                        // Customer: { type: "string" },
                        //Project: { type: "string" },
                        Status: { type: "string" },
                        // Owner: { type: "string" },
                        WeekStartDate: { type: "date" }
                        //StHours: { type: "number" },
                        //OtHours: { type: "number" },
                        // Task: { type: "string" },
                        // Note: { type: "string" },

                    }                   
               
           });

        var myDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/GetJson",
                    dataType: 'json'
                }

            },
            schema: {
                      model: {
                    id: "TimeSheetId",
                    fields: {
                        // Customer: { type: "string" },
                        //Project: { type: "string" },
                        Status: { type: "string" },
                        // Owner: { type: "string" },
                        WeekStartDate: { type: "date", },
                        //StHours: { type: "number" },
                        //OtHours: { type: "number" },
                        // Task: { type: "string" },
                        // Note: { type: "string" },

                    }
                                        
            },

            parse: function (data) {
                    return data.GetTimeSheetResult;
                },
                type: "json"
            },
            serverPaging: true,
            pageSize: 10,
            serverSorting: true,
            group: { field: "Status" }
        });

       

        new kendo.mobile.Application();
        
        var SummaryviewModel = kendo.observable({

            data: new SummaryModel(),
            navigate: function (e)
            {   
                
                debugger;
                var wsd = kendo.toString(kendo.parseDate(e.dataItem.WeekStartDate), 'd');
                // alert(wsd);
                  var app = new kendo.mobile.Application();
                  app.navigate("#tabstrip-TimeSheetWeeklyView?q=" + wsd , "Slide");

            },
            
         


        });

        kendo.bind($("#tabstrip-TimeSheetWeekly"), SummaryviewModel);

     

    </script> 
    
    
    <script type="text/javascript">      
    
       
               
         weeklyviewDS = new kendo.data.DataSource({
            transport: {
                read: {
                    // url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/GetJson?q=01/01/2014",
                    dataType: 'json'
                }

            },
            schema: {
                model: {
                    id: "TimeSheetId",
                    fields: {

                        Project: { type: "string" },
                        Status: { type: "string" },
                        Owner: { type: "string" },
                        WeekStartDate: { type: "date" },
                        TimeSheetDate: { type: "date" },
                        StHours: { type: "number" },
                        OtHours: { type: "number" },

                    }
                },

                parse: function (data) {
                    //result comes from svc call. e.g
                    return data.GetWeeklyTimeSheetResult;
                },
                type: "json"
            },
            serverPaging: true,
            pageSize: 10,
            serverSorting: true,
            group: { field: "TimeSheetDate" },


        });

         
        
         var WeeklyviewModel = kendo.observable({

             
           
             //data: new SummaryModel(),
            process: function (e)
            {
                 debugger;
                 
                 var action = e.button.element.context.innerText;
                 var  weekstartdate, timesheetdate, tsId;
                 weekstartdate =   kendo.toString(kendo.parseDate(e.dataItem.WeekStartDate), 'd');
                 timesheetdate =   kendo.toString(kendo.parseDate(e.dataItem.TimeSheetDate), 'd');
                 tsId = e.dataItem.TimeSheetId;
                 
                  if(action == "Edit")
                  {
                      //redirect to another view with parameter
                      //  alert("TimeSheetId:" + tsId + " WSDate : " + weekstartdate + " timesheetDate :" + timesheetdate);
                       var app = new kendo.mobile.Application();
                      app.navigate("#tabstrip-TimeSheetLog?wsd=" + weekstartdate + "&tsd=" + timesheetdate+ "&tsid="+ tsId , "Slide");

                      
                  }
                  else if(action == "Delete")
                  {
                      /* //delete record
                        $.ajax({
                        type: "DELETE",
                        //url: "http://localhost:8005/Service.svc/TimeSheet/"  + $("#timesheetIdtext").val() ,
                        url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/TimeSheet/"  + $("#timesheetIdtext").val() ,
                        // data: 1,
                        //contentType: "application/json; charset=utf-8",
                        // dataType: "jsonp",
                       complete: function (xhr, status) {
                                if (status === 'error' || !xhr.responseText) {
                                    // alert(status);
                         }
                    else {
                                   alert("Delete Success!")
                          }
                        }        
                    });*/
                  }
                  else
                  {
                      
                      
                  }
                
                // alert(data.index());
                // var app = new kendo.mobile.Application();
                //  app.navigate("#tabstrip-TimeSheetWeeklyView?q=" + wsd , "Slide");

            },
            

        });
        
            kendo.bind($("#tabstrip-TimeSheetWeeklyView"), WeeklyviewModel);

           function getWeeklyPageParameters(e) {
           
               //   alert("1");
               wds = e.view.params.q;
               //   alert("2");
               //  ();
               //new kendo.mobile.Application();
               weeklyviewDS.transport.options.read.url = "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/GetJson?q=" + wds;
               //   alert("3");
               //Read data source to update
              weeklyviewDS.read();
               //        alert(e.view.params.q);
          }
        
         new kendo.mobile.Application();    

   </script>
   
     <div id="tabstrip-ExpenseLog" data-role="view" data-title="Time Log" data-init="initForm" data-use-native-scrolling="true" >
                <form action="./index.html">
        <ul data-role="listview" data-style="inset">
            
            <li><a data-role="backbutton">Back</a><a data-role="button" data-click="onClick">DONE</a>    
            </li>
           <li>
                <label>Customer
                    <select id="dropdown">
                        <option value="First Option">EFA</option>
                        <option value="Second Option">Spirax Spacro</option>
                        <option value="Third Option">Trinity</option>
                        <option value="Fourth Option">PunterSouthHall</option>
                    </select>
                </label>
            </li>
              <li>
                <label>Project
                    <select id="Select1">
                        <option value="First Option">Project 1</option>
                        <option value="Second Option">Project 2</option>
                        <option value="Third Option">Project 3</option>
                        <option value="Fourth Option">Project 4</option>
                        <option value="First Option">Project 5</option>
                        <option value="Sixth Option">Project 6</option>
                    </select>
                </label>
            </li>           
              <ul data-role="listview" >
   
            <li>
                <label>Expense Detail
                    <input type="text"  id="ExpenseDetail" />
                </label>
            </li>
           
         
            <li>
                <label>
                    Gross Value
                    <input type="number" pattern="(\d{3})([\.])(\d{2})" />
                </label>
            </li>
            <li>
                <label>
                    VAT Value
                      <input type="number" pattern="(\d{3})([\.])(\d{2})" />
                </label>
            </li>
                   <li>
                <label>
                    NET Value
                      <input type="number" pattern="(\d{3})([\.])(\d{2})" />
                </label>
            </li>
             <li>
                <label>
                    Approve Notes
                    <br>
                    <textarea style="resize: none">Note...</textarea>
                </label>
            </li>
             </ul>
         </form>       
    </div>      
     <!-- <div data-role="view" id="foo" data-show="fooShow">test</div>-->
     <div id="tabstrip-TimeSheetLog" data-role="view" data-title="Time Sheet Log" data-init="initForm" data-use-native-scrolling="true" data-show="getParameters">            
         <form action="./index.html">
        <ul >
            
            <!--<a data-role="button" href="#tabstrip-TimeSheetLog?TimeSheetId=2">Edit with <strong>TimeSheet</strong> with TimeSheetId parameter</a>-->
                  
            <a data-role="backbutton">Back</a>
          <!--  <input type="text"  id="timesheetIdtext" />  -->
          <!--  <a data-role="button" data-bind="click: create">Create</a>   -->
          <!--  <a data-role="button"data-bind="click: load">Load</a>  -->
            <a data-role="button" data-bind="click: update">Done</a> 
          <!--    <a data-role="button" data-bind="click: destory">Delete</a> -->
              <li>
          
                <label>Customer
                    <select id="Select2"  data-bind="value: data.Customer">
                        <option value="EFA">EFA</option>
                        <option value="Spirax">Spirax Spacro</option>
                        <option value="Trinity">Trinity</option>
                        <option value="PunterSouthHall">PunterSouthHall</option>
                    </select>
                </label>
           
            </li>
              <li>
                <label>Project
                    <select id="Select3" data-bind="value: data.Project">
                        <option value="p1">Project 1</option>
                        <option value="p2">Project 2</option>
                        <option value="p3">Project 3</option>
                        <option value="p4">Project 4</option>
                        <option value="p5">Project 5</option>
                        <option value="p6">Project 6</option>
                    </select>
                </label>
                       
            </li>
   
            <li>
                <label>Task
                    <input type="text"  id="TaskName" data-bind="value: data.Task"/>
                </label>
            </li>
           
         
            <li>
                <label>
                    Stad.Hours
                    <input type="number" id="standHours" data-bind="value: data.StHours"/>
                </label>
            </li>
            <li>
                <label>
                    OT.Hours
                    <input type="number" id="otHours" data-bind="value: data.OtHours" />
                </label>
            </li>
             <li>
                <label>
                    Approve Notes
                    <br/>
                    <textarea style="resize: none" data-bind="value: data.Note" >Note...</textarea>
                    </label>
            </li>
             </ul>
         </form>       
</div>
       <script type="text/javascript">
           //define a model

           var Model = kendo.data.Model.define({
               id: "TimeSheetId",
               fields: {
                   Customer: { type: "string" },
                   Project: { type: "string" },
                   Status: { type: "string" },
                   Owner: { type: "string" },
                   StHours: { type: "number" },
                   OtHours: { type: "number" },
                   Task: { type: "string" },
                   Note: { type: "string" }
               }
           });


           var dataSource = new kendo.data.DataSource({

               type: 'json',
               transport: {
                   create: {
                       type: "POST",
                       url: "http://localhost:8005/Service.svc/CreateTimeSheet/0",
                       contentType: "application/json; charset=utf-8",
                       dataType: "json",
                       processData: true,

                       success: function (data, status, jqXHR) {
                           alert("success..." + data);
                       },
                       error: function (xhr) {
                           alert(xhr.responseText);
                       }
                   },
                  
                   parameterMap: function (data, type) {
                       return kendo.stringify(data);
                   }

               },
               schema: {
                   model: Model
               }
           });


           var viewModel = kendo.observable({

               data: new Model(),
               create: function (e) {
                   //if (confirm("Are you sure you want to delete this product?")) {
                   //var taskname =   viewModel.get("Task");
                   //}
                   //  console.log("this", this.data);
                   // dataSource.add(this.data);
                   // save the created data item
                   // dataSource.sync();
                   // e.preventDefault();
                      debugger;
                                     
               
                   
                  var wsd = kendo.parseDate("2014/05/05", "yyyy/MM/dd", "en-GB").getTime();
                   var tsd = kendo.parseDate("2014/05/07", "yyyy/MM/dd", "en-GB").getTime();
                  
                   
                  
 
                     $.ajax({
                        type: "POST",
                         url: "http://localhost:8005/Service.svc/CreateTimeSheet/0",
                         //url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/CreateTimeSheet/0",
                        data: JSON.stringify(this.data),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            alert("new timesheet has been created with a new ID : " + data);
                        },
                        error: function (xhr) {
                            alert(xhr.responseText);
                        }
                    });                   
                   
               },

               //load: function (timesheetId) {
                    load: function (tsid) {
                    $.ajax({
                        type: "GET",
                        // url: "http://localhost:8005/Service.svc/GetJson/" + + $("#timesheetIdtext").val() ,
                        
                         url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/GetJson/" + tsid ,
                        //+ $("#tabstrip-TimeSheetLog").data("timesheetIdtext"),
                        data: 1,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            //  alert(data);
                           viewModel.data = data.GetTimeSheetByIdResult;
                            //viewModel.data.WeekStartDate = '\/Date(' + wsd + ')\/';
                            //viewModel.data.TimeSheetDate = '\/Date('+ tsd +')\/';
                            // viewModel.data.Status ="Submitted";
                           kendo.bind($("#tabstrip-TimeSheetLog"), viewModel);
                        },
                        error: function (xhr) {
                            alert(xhr.responseText);
                        }
                    });

                
            },
               
              update: function () {
                  // alert(this.data.TimeSheetId + "- " + this.data.StHours );
                  $.ajax({
                        type: "POST",
                      //url: "http://localhost:8005/Service.svc/UpdateTimeSheet/"  + $("#timesheetIdtext").val() ,
                        url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/UpdateTimeSheet/"  + this.data.TimeSheetId ,
                        data: JSON.stringify(this.data),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            // alert("Updated Successfully" + data);
                            // viewModel.data = data.GetTimeSheetByIdResult;
                            // kendo.bind($("#view"), viewModel);
                        },
                        error: function (xhr) {
                            //  alert(xhr.responseText);
                        }
                    });
                },
                destory : function () {
                    $.ajax({
                        type: "DELETE",
                        //url: "http://localhost:8005/Service.svc/TimeSheet/"  + $("#timesheetIdtext").val() ,
                        url: "http://tdtandews.cloudapp.net/TANDEWS/Service.svc/TimeSheet/"  + $("#timesheetIdtext").val() ,
                        // data: 1,
                        //contentType: "application/json; charset=utf-8",
                        // dataType: "jsonp",
                       complete: function (xhr, status) {
                                if (status === 'error' || !xhr.responseText) {
                                    // alert(status);
                         }
                    else {
                                   alert("Delete Success!")
                          }
                        }        
                    });
                },


           });

           kendo.bind($("#tabstrip-TimeSheetLog"), viewModel);

          function getParameters(e) {
             // {bar: "baz"}
              //  e.view.params[0].ToString()
              //  alert(e.view.params.TimeSheetId);
                debugger;
                if(e.view.params.tsid != undefined)
               {
                   // alert(e.view.params.TimeSheetId);
                      viewModel.load(e.view.params.tsid);
                  
               }
              
        }
   </script>    
<script>
    function initForm() {
        var body = $(".km-pane");

        if (kendo.ui.DropDownList) {
            $("#dropdown").kendoDropDownList({
                // The options are needed only for the desktop demo, remove them for mobile.
                //  popup: { appendTo: body },
                // animation: { open: { effects: body.hasClass("km-android") ? "fadeIn" : body.hasClass("km-ios") || body.hasClass("km-wp") ? "slideIn:up" : "slideIn:down" } }
            });
        }

        if (kendo.ui.Slider) {
            $("#slider").kendoSlider({ tooltip: { enabled: false } });
        }
        
        
        
        
    }
</script>
<script>
    var app = new kendo.mobile.Application(document.body);
</script>

         <!--Layout-->
    <div data-role="layout" data-id="tabstrip-layout">

        <!--Header-->
        <div data-role="header">
            <div data-role="navbar">
                <span data-role="view-title"></span>
            </div>
        </div>

        <!--Footer-->
        <div data-role="footer">
            <div data-role="tabstrip">
                <a href="#/" data-icon="home">Home</a>
              <!--  <a href="#tabstrip-login" data-icon="contacts">Login</a> -->
             
                <a href="#tabstrip-TimeSheetWeekly" data-icon="globe">Expense</a> 
              <!--   <a href="#tabstrip-TimeSheetWeeklyView" data-icon="globe">Weekly View</a> -->
               <!-- <a href="#tabstrip-TimeSheetLog" data-icon="globe">Log</a>-->
            </div>
        </div>
    </div>
</body>
</html>
